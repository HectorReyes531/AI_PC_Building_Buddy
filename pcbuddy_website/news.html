<!DOCTYPE HTML>

<html>

<head>
    <title>Trending News</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>
    <!--Have to hard code style in the html to override the problems caused by bootstrap and main.css conflicting-->
    <style>
        #main header,
        h1 {
            color: #fff;
        }

        h1 {
            font: inherit;
            color: #fff;
            font-weight: 800;
            letter-spacing: 0.225em;
            line-height: 1em;
            margin: 0 0 1em 0;
            text-transform: uppercase;
        }

        #header h1 {
            -moz-transition: opacity 0.2s ease;
            -webkit-transition: opacity 0.2s ease;
            -ms-transition: opacity 0.2s ease;
            transition: opacity 0.2s ease;
            height: inherit;
            left: 1.25em;
            line-height: inherit;
            position: absolute;
            top: 0;
        }

        #header h1 a {
            border: 0;
            display: block;
            height: inherit;
            line-height: inherit;
        }

        @media screen and (max-width: 736px) {

            #header h1 a {
                font-size: 0.8em;
            }

        }
    </style>
</head>

<body class="is-preload">

    <!-- Page Wrapper -->
    <div id="page-wrapper">

        <!-- Alex: this is the menu bar that can be toggled once clicked -->
        <header id="header">
            <h1><a href="index.html">PC Building Buddy</a></h1>
            <nav id="nav">
                <ul>
                    <li class="special">
                        <a href="#menu" class="menuToggle"><span>Menu</span></a>
                        <div id="menu">
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="generate.html">Builder</a></li>
                                <li><a href="news.html">News and Trends</a></li>
                                <li><a href="howtobuild.html">How-To-Build Guide</a></li>
                                <li><a href="dbrep.html">Data</a></li>
                                <li><a href="login_signup.html">Register</a></li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Main -->
        <article id="main">
            <header>
                <h2>Trending News about Technology</h2>
                <p>Results within the last month</p>
            </header>
            <section class="wrapper style5">
                <!--the search bar-->
                <form class="d-flex" role="search">
                    <input id="desiredSearch" class="form-control me-2 input-sm" type="search" placeholder="Search"
                        aria-label="Search">
                    <button id="search" class="btn btn-outline-success" type="submit">Search</button>

                </form>
                <div class="container">
                    <h2>Current Trending News (<span id="resultCount"></span>Results)</h2>
                    <div class="row content">
                        <!--Creating a Card to fit the articles in-->
                        <div class="card my-3 mx-3" style="width:250px">
                            <img src="..." class="card-image-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title"> Card Title</h5>
                                <p class="card-text">...</p>
                                <a href="#" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Source</a>
                                <input type="text" class="copy-link-input" value="Wakanda forever" id="toCopy">
                                <!-- adds a copy button-->
                                <button type="button" class="copy-link-button" onclick="copyFunc()">
                                    <span class="material-symbols-outlined">content_copy</span>
                                </button>
                            </div>
                        </div>

                    </div>
                    <!-- buttons to cycle through the article pages-->
                    <div class="d-flex justify-content-end my-1">
                        <button class="btn btn-primary" id="previous">Previous</button>
                        <button class="btn btn-primary" id="next">Next</button>
                    </div>
                </div>
            </section>
        </article>

        <!-- social media icons, no accounts just yet -->
        <footer id="footer">
            <ul class="icons">
                <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
                <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
                <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
                <li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
                <li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
            </ul>
            <ul class="copyright">
                <li>&copy; Untitled</li>
                <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
            </ul>
        </footer>

    </div>

    <!-- Scripts -->
    <!-- Have to place ampersand before to fetch with all the proper parameters-->
    <!-- bootstrap for the cards-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <!-- javascript files for the toggled menu-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- fetchs news from api-->
    <script>
        let currPage = 1

        const fetchNews = async (page, q) => {
            // currently fetches the everything end point, while taking in a query from a certain date
            // limits itself to 12 articles per page and english articles
            console.log("getting news...");
            var url = 'https://newsapi.org/v2/everything?' +
                'q=' +
                q +
                '&from=2024-05-11&' +
                'pageSize=12&' +
                'language=en&' +
                'page=' +
                page +
                '&sortBy=popularity&' +
                'apiKey=1ebb9915990f40fb85979ee39a7f4a11';

            var req = new Request(url);
            // takes in response as a json
            let a = await fetch(req)
            let response = await a.json()
            var i = 0;
            // console.log(JSON.stringify(response))
            // console.log(response)
            let str = ""
            // populate all the cards with articles
            // currently copy url copies line above rather than copying the link of website
            resultCount.innerHTML = response.totalResults
            for (let item of response.articles) {
                let copiedUrl = String(item.url);
                let inputID = `toCopy-${i}`;
                // console.log(copiedUrl);
                i += 1;

                str = str + `<div class="card my-3 mx-3" style="width:250px">
                        <img src="${item.urlToImage}" class="card-image-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title"> ${item.title.slice(0, 50)}...</h5>
                            <p class="card-text">${item.description}</p>
                            <div class="d-flex flex-row justify-content-between mt-auto"> 
                                <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="align-self-end btn btn-primary">Source</a>
                                <input type="text" class="copy-link-input" value="${copiedUrl}" id=${inputID}>
                                <button type="button" class="copy-link-button" onclick="copyFunc('${inputID}')">
                                    <span class="material-symbols-outlined">content_copy</span>
                                </button>
                            </div>
                        </div>
                    </div>`
                // document.querySelectorAll(".copy-link").forEach(copyLinkContainer => {
                //     const inputField = copyLinkContainer.querySelector(".copy-link-input");
                //     const copyButton = copyLinkContatiner.querySelector(".copy-link-button");

                //     inputField.addEventListener("focus", () => inputField.select());
                //     copyButton.addEventListener("click", () => {
                //         const text = inputFIeld.value;
                //         console.log(text);
                //         inputField.select();
                //         navigator.clipboard.writeText(text);
                //         inputField.value = "Successfully copied";
                //         setTimeout(() => inputField.value = text, 2000);
                //     })
                // })


            }
            document.querySelector(".content").innerHTML = str
        }
        // initializes first couple articles
        fetchNews(1, "technology");


        document.getElementById("test-test", (e) => {
            e.preventDefault();
            console.log("test")
        })

        // taking elements from the search bar
        search.addEventListener("click", (e) => {
            e.preventDefault();
            let query = desiredSearch.value;
            fetchNews(1, query)
        })

        function linkCopy() {
            // Url.innerHTML = window.location.href;
            console.log("copyLink");
            //navigator.clipboard.writeText(url);
        }

        // goes to the prev page of articles
        document.getElementById("previous").addEventListener("click", (e) => {
            e.preventDefault()
            if (currPage > 1) {
                q = "technology"
                currPage = currPage - 1
                fetchNews(currPage, q)
            }

        })
        // goes to the next page of articles
        document.getElementById("next").addEventListener("click", (e) => {
            e.preventDefault();
            q = "technology"
            currPage = currPage + 1;
            fetchNews(currPage, q);
        })

        // copy function that is called when the copy button is clicked
        function copyFunc(inputID){
            var copyText = document.getElementById(inputID);
            copyText.select();
            // this allows mobile users to copy to clipboard
            copyText.setSelectionRange(0,99999);
            navigator.clipboard.writeText(copyText.value);
            
        }

    </script>

</body>

</html>